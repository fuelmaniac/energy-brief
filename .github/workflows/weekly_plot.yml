name: Weekly Brent-JKM Plot

on:
  schedule:
    - cron: '45 5 * * 0'           # Her Pazar 08:45 TR (UTC+3=05:45 UTC)
  workflow_dispatch: {}

permissions:
  contents: write                   # PNG push için gerekli

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      PLATTS_TOKEN: ${{ secrets.PLATTS_TOKEN }}   # yoksa boş; script sadece Brent çizer
      MPLBACKEND: Agg                              # headless matplotlib

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          persist-credentials: true
          fetch-depth: 0

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install deps
        run: pip install -r scripts/requirements.txt

      - name: Run plot script
        run: |
          python scripts/generate_energy_spread.py
          echo "---- List docs/img ----"
          ls -lah docs/img || true

      - name: Commit & push PNG (only if exists)
        run: |
          if ls docs/img/*.png 1>/dev/null 2>&1; then
            git config --local user.email "bot@github" && git config --local user.name "Plot Bot"
            git add docs/img/*.png
            git commit -m "weekly plot $(date -I)" || true
            git push
          else
            echo "No PNG generated — skipping commit"
          fi
